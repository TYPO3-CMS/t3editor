'use strict';(function(l){"object"==typeof exports&&"object"==typeof module?l(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],l):l(CodeMirror)})(function(l){function r(b,e){if(!b.hasOwnProperty(e))throw Error("Undefined state "+e+" in simple mode");}function q(b,e){if(!b)return/(?:)/;var c="";b instanceof RegExp?(b.ignoreCase&&(c="i"),b=b.source):b=String(b);return new RegExp((!1===e?"":"^")+"(?:"+b+")",c)}function u(b){if(!b)return null;if(b.apply)return b;
if("string"==typeof b)return b.replace(/\./g," ");for(var e=[],c=0;c<b.length;c++)e.push(b[c]&&b[c].replace(/\./g," "));return e}function v(b,e){(b.next||b.push)&&r(e,b.next||b.push);this.regex=q(b.regex);this.token=u(b.token);this.data=b}function w(b,e){return function(c,a){if(a.pending){var d=a.pending.shift();0==a.pending.length&&(a.pending=null);c.pos+=d.text.length;return d.token}if(a.local){if(a.local.end&&c.match(a.local.end))d=a.local.endToken||null,a.local=a.localState=null;else{d=a.local.mode.token(c,
a.localState);var g;a.local.endScan&&(g=a.local.endScan.exec(c.current()))&&(c.pos=c.start+g.index)}return d}for(var h=b[a.state],f=0;f<h.length;f++)if(d=h[f],g=(!d.data.sol||c.sol())&&c.match(d.regex)){d.data.next?a.state=d.data.next:d.data.push?((a.stack||(a.stack=[])).push(a.state),a.state=d.data.push):d.data.pop&&a.stack&&a.stack.length&&(a.state=a.stack.pop());if(d.data.mode){var h=void 0,m=e,f=a,k=d.data.mode,n=d.token;if(k.persistent)for(var p=f.persistentStates;p&&!h;p=p.next)if(k.spec?t(k.spec,
p.spec):k.mode==p.mode)h=p;m=h?h.mode:k.mode||l.getMode(m,k.spec);p=h?h.state:l.startState(m);k.persistent&&!h&&(f.persistentStates={mode:m,spec:k.spec,state:p,next:f.persistentStates});f.localState=p;f.local={mode:m,end:k.end&&q(k.end),endScan:k.end&&!1!==k.forceEnd&&q(k.end,!1),endToken:n&&n.join?n[n.length-1]:n}}d.data.indent&&a.indent.push(c.indentation()+e.indentUnit);d.data.dedent&&a.indent.pop();(h=d.token)&&h.apply&&(h=h(g));if(2<g.length){a.pending=[];for(f=2;f<g.length;f++)g[f]&&a.pending.push({text:g[f],
token:d.token[f-1]});c.backUp(g[0].length-(g[1]?g[1].length:0));return h[0]}return h&&h.join?h[0]:h}c.next();return null}}function t(b,e){if(b===e)return!0;if(!b||"object"!=typeof b||!e||"object"!=typeof e)return!1;var c=0,a;for(a in b)if(b.hasOwnProperty(a)){if(!e.hasOwnProperty(a)||!t(b[a],e[a]))return!1;c++}for(a in e)e.hasOwnProperty(a)&&c--;return 0==c}function x(b,e){return function(c,a,d){if(c.local&&c.local.mode.indent)return c.local.mode.indent(c.localState,a,d);if(!(d=null==c.indent||c.local)&&
(d=e.dontIndentStates)){a:{d=e.dontIndentStates;for(var g=0;g<d.length;g++)if(d[g]===c.state){d=!0;break a}d=void 0}d=-1<d}if(d)return l.Pass;d=c.indent.length-1;g=b[c.state];a:for(;;){for(var h=0;h<g.length;h++){var f=g[h];if(f.data.dedent&&!1!==f.data.dedentIfLineStart){var m=f.regex.exec(a);if(m&&m[0]){d--;if(f.next||f.push)g=b[f.next||f.push];a=a.slice(m[0].length);continue a}}}break}return 0>d?0:c.indent[d]}}l.defineSimpleMode=function(b,e){l.defineMode(b,function(b){return l.simpleMode(b,e)})};
l.simpleMode=function(b,e){r(e,"start");var c={},a=e.meta||{},d=!1,g;for(g in e)if(g!=a&&e.hasOwnProperty(g))for(var h=c[g]=[],f=e[g],m=0;m<f.length;m++){var k=f[m];h.push(new v(k,e));if(k.indent||k.dedent)d=!0}b={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:d?[]:null}},copyState:function(a){var b={state:a.state,pending:a.pending,local:a.local,localState:null,indent:a.indent&&a.indent.slice(0)};a.localState&&(b.localState=l.copyState(a.local.mode,a.localState));
a.stack&&(b.stack=a.stack.slice(0));for(var c=a.persistentStates;c;c=c.next)b.persistentStates={mode:c.mode,spec:c.spec,state:c.state==a.localState?b.localState:l.copyState(c.mode,c.state),next:b.persistentStates};return b},token:w(c,b),innerMode:function(a){return a.local&&{mode:a.local.mode,state:a.localState}},indent:x(c,a)};if(a)for(var n in a)a.hasOwnProperty(n)&&(b[n]=a[n]);return b}});
