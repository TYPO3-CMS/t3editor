!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}((function(t){var e=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),n=t.Pos,r={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function i(t){return t&&t.bracketRegex||/[(){}[\]]/}function c(t,e,c){var o=t.getLineHandle(e.line),l=e.ch-1,s=c&&c.afterCursor;null==s&&(s=/(^| )cm-fat-cursor($| )/.test(t.getWrapperElement().className));var h=i(c),u=!s&&l>=0&&h.test(o.text.charAt(l))&&r[o.text.charAt(l)]||h.test(o.text.charAt(l+1))&&r[o.text.charAt(++l)];if(!u)return null;var f=">"==u.charAt(1)?1:-1;if(c&&c.strict&&f>0!=(l==e.ch))return null;var m=t.getTokenTypeAt(n(e.line,l+1)),g=a(t,n(e.line,l+(f>0?1:0)),f,m||null,c);return null==g?null:{from:n(e.line,l),to:g&&g.pos,match:g&&g.ch==u.charAt(0),forward:f>0}}function a(t,e,c,a,o){for(var l=o&&o.maxScanLineLength||1e4,s=o&&o.maxScanLines||1e3,h=[],u=i(o),f=c>0?Math.min(e.line+s,t.lastLine()+1):Math.max(t.firstLine()-1,e.line-s),m=e.line;m!=f;m+=c){var g=t.getLine(m);if(g){var d=c>0?0:g.length-1,k=c>0?g.length:-1;if(!(g.length>l))for(m==e.line&&(d=e.ch-(c<0?1:0));d!=k;d+=c){var p=g.charAt(d);if(u.test(p)&&(void 0===a||t.getTokenTypeAt(n(m,d+1))==a)){var v=r[p];if(v&&">"==v.charAt(1)==c>0)h.push(p);else{if(!h.length)return{pos:n(m,d),ch:p};h.pop()}}}}}return m-c!=(c>0?t.lastLine():t.firstLine())&&null}function o(t,r,i){for(var a=t.state.matchBrackets.maxHighlightLineLength||1e3,o=[],l=t.listSelections(),s=0;s<l.length;s++){var h=l[s].empty()&&c(t,l[s].head,i);if(h&&t.getLine(h.from.line).length<=a){var u=h.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";o.push(t.markText(h.from,n(h.from.line,h.from.ch+1),{className:u})),h.to&&t.getLine(h.to.line).length<=a&&o.push(t.markText(h.to,n(h.to.line,h.to.ch+1),{className:u}))}}if(o.length){e&&t.state.focused&&t.focus();var f=function(){t.operation((function(){for(var t=0;t<o.length;t++)o[t].clear()}))};if(!r)return f;setTimeout(f,800)}}function l(t){t.operation((function(){t.state.matchBrackets.currentlyHighlighted&&(t.state.matchBrackets.currentlyHighlighted(),t.state.matchBrackets.currentlyHighlighted=null),t.state.matchBrackets.currentlyHighlighted=o(t,!1,t.state.matchBrackets)}))}t.defineOption("matchBrackets",!1,(function(e,n,r){function i(t){t.state.matchBrackets&&t.state.matchBrackets.currentlyHighlighted&&(t.state.matchBrackets.currentlyHighlighted(),t.state.matchBrackets.currentlyHighlighted=null)}r&&r!=t.Init&&(e.off("cursorActivity",l),e.off("focus",l),e.off("blur",i),i(e)),n&&(e.state.matchBrackets="object"==typeof n?n:{},e.on("cursorActivity",l),e.on("focus",l),e.on("blur",i))})),t.defineExtension("matchBrackets",(function(){o(this,!0)})),t.defineExtension("findMatchingBracket",(function(t,e,n){return(n||"boolean"==typeof e)&&(n?(n.strict=e,e=n):e=e?{strict:!0}:null),c(this,t,e)})),t.defineExtension("scanForBracket",(function(t,e,n,r){return a(this,t,e,n,r)}))}));